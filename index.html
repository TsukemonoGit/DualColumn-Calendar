<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A4横・2ヶ月分割カレンダー生成</title>
    <style>
      /* 基本設定 */
      :root {
        --orange-main: #e48100;
        --gray-text: #666;
        --gray-light: #999;
        --border-solid: #e0e0e0;
        --border-dotted: #ccc;
        --bg-holiday: #fff5f5;
        --sat-blue: #1976d2;
        --sun-red: #d32f2f;
      }

      body {
        margin: 0;
        padding: 0;
        font-family:
          "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans",
          Meiryo, sans-serif;
        background-color: #f0f0f0;
      }

      /* 操作パネル */
      #controls {
        padding: 20px;
        background: white;
        border-bottom: 1px solid #ccc;
        text-align: center;
      }

      #controls input {
        font-size: 1.2rem;
        padding: 5px;
        width: 80px;
      }

      #controls button {
        font-size: 1.1rem;
        padding: 6px 20px;
        cursor: pointer;
      }

      /* 印刷設定 */
      @page {
        size: A4 landscape;
        margin: 0;
      }

      @media print {
        #controls {
          display: none;
        }
        body {
          background-color: white;
        }
        .page {
          page-break-after: always;
          box-shadow: none !important;
          margin: 0 !important;
        }
      }

      /* ページ・レイアウト */
      .page {
        width: 297mm;
        height: 210mm;
        display: flex;
        background: white;
        margin: 10px auto;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      /* 余白を最小化して記入スペースを最大化 */
      .calendar-container {
        width: 148.5mm;
        height: 210mm;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        padding: 4mm; /* 10mmから縮小 */
        position: relative;
      }

      /* 中央の裁断線（プレビュー用） */
      .page > .calendar-container:first-child {
        border-right: 1px dashed #eee;
      }

      /* ヘッダーの余白をさらに圧縮 */
      .header {
        display: flex;
        justify-content: center;
        align-items: baseline;
        border-bottom: 1px solid var(--border-solid);
        padding-bottom: 1px;
        margin-bottom: 1px; /* 2pxから縮小 */
        position: relative;
      }

      .month-large {
        font-size: 38pt; /* 少しだけサイズアップ */
        font-weight: bold;
        color: var(--orange-main);
        line-height: 1;
        text-align: center;
      }

      .year-small {
        font-size: 14pt;
        color: var(--orange-main);
        position: absolute; /* 右端に固定 */
        right: 0;
        bottom: 2px; /* ヘッダー下線に合わせる */
      }

      /* カレンダー本体（2列） */
      .calendar-body {
        flex-grow: 1;
        display: flex;
        border-bottom: 1px solid var(--border-solid);
      }

      .column {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .column-left {
        border-right: 1px dotted var(--border-dotted);
      }

      /* 日付行の祝日名配置を右下に変更 */
      .day-row {
        flex: 1;
        display: flex;
        align-items: center;
        border-bottom: 1px dotted var(--border-dotted);
        padding: 0;
        box-sizing: border-box;
        min-height: 0;
        position: relative; /* 祝日名の配置基準 */
      }

      .day-row:last-child {
        border-bottom: none;
      }

      /* 日付数字を大きく、曜日を小さく調整 */
      .day-num {
        color: var(--orange-main);
        font-weight: 600; /* より太く */
        width: 1.6em; /* 幅を少しタイトに */
        text-align: right;
        margin-right: 6px;
        font-size: 16pt; /* 13ptから拡大 */
      }

      /* 祝日名が右下にあるため、曜日の横の余白は不要 */
      .day-week {
        color: var(--gray-text);
        width: 1em;
        font-size: 8pt;
        text-align: center;
        padding-top: 0.5em;
      }

      .holiday-name {
        position: absolute;
        right: 4px; /* 右端から少し離す */
        bottom: 2px; /* 下端から少し離す */
        font-size: 7pt;
        color: var(--sun-red);
        line-height: 1;
        max-width: 70%; /* 左側の数字に重なりすぎないよう制限 */
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis; /* 長い祝日名は省略 */
        pointer-events: none; /* クリック等の邪魔をしない */
        opacity: 0.8; /* 少し透過させて控えめに */
      }
      /* 色設定 */
      .bg-holiday {
        background-color: var(--bg-holiday);
      }
      .text-sat {
        color: var(--sat-blue) !important;
      }
      .text-sun {
        color: var(--sun-red) !important;
      }

      /* フッターの余白を圧縮 */
      .footer {
        margin-top: 2px;
        padding-top: 1px;
        font-size: 8pt;
        color: var(--gray-light);
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <input type="number" id="yearInput" value="2026" /> 年
      <button onclick="generateCalendar()">生成・更新</button>
      <button onclick="window.print()">印刷する</button>
    </div>

    <div id="output"></div>

    <script>
      let holidays = {};

      /**
       * 内閣府の祝日CSVを取得・パース
       */
      /**
       * 内閣府の祝日CSVを取得・パース
       * プロキシを経由してCORS制約を回避
       */
      async function fetchHolidays() {
        try {
          // CORS回避のためのプロキシURLを付与
          const targetUrl =
            "https://www8.cao.go.jp/chosei/shukujitsu/syukujitsu.csv";
          const proxyUrl =
            "https://corsproxy.io/?" + encodeURIComponent(targetUrl);

          const response = await fetch(proxyUrl);

          if (!response.ok) throw new Error("Network response was not ok");

          const arrayBuffer = await response.arrayBuffer();
          const decoder = new TextDecoder("shift-jis");
          const text = decoder.decode(arrayBuffer);

          const lines = text.split("\n");
          holidays = {};

          for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split(",");
            if (parts.length >= 2) {
              // CSVの形式: "2026/1/1,元日"
              const dateStr = parts[0].trim();
              const name = parts[1].trim();

              // 日付のゼロ埋めを解除してキーを統一（例: 2026/01/01 -> 2026/1/1）
              const d = new Date(dateStr);
              if (!isNaN(d.getTime())) {
                const formattedKey = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
                holidays[formattedKey] = name;
              }
            }
          }
        } catch (e) {
          console.error("祝日データの取得に失敗しました。", e);
          alert(
            "祝日データの取得に失敗しました。インターネット接続を確認するか、しばらく時間をおいて試してください。",
          );
        }
      }

      /**
       * 指定した月の日数と情報を取得
       */
      function getMonthData(year, month) {
        const lastDay = new Date(year, month, 0).getDate();
        const days = [];
        const weekDays = ["日", "月", "火", "水", "木", "金", "土"];

        for (let d = 1; d <= lastDay; d++) {
          const dateObj = new Date(year, month - 1, d);
          const yyyy = dateObj.getFullYear();
          const mm = String(dateObj.getMonth() + 1).padStart(1, "0");
          const dd = String(dateObj.getDate()).padStart(1, "0");
          const dateKey = `${yyyy}/${mm}/${dd}`;

          const dayIdx = dateObj.getDay();
          const isHoliday = !!holidays[dateKey];

          days.push({
            day: d,
            week: weekDays[dayIdx],
            dayIdx: dayIdx,
            holiday: holidays[dateKey] || "",
            isHoliday: isHoliday,
          });
        }
        return days;
      }

      /**
       * カレンダーHTMLの生成
       */
      function createMonthHtml(year, month) {
        const days = getMonthData(year, month);

        let leftColHtml = "";
        let rightColHtml = "";

        // 左列：1日～16日（必ず16回ループ）
        for (let i = 0; i < 16; i++) {
          leftColHtml += createDayRowHtml(days[i]);
        }

        // 右列：17日～32日相当（必ず16回ループさせて高さを揃える）
        for (let i = 16; i < 32; i++) {
          // days[i] が存在しない（月末以降）場合は、createDayRowHtmlが空の行を返します
          rightColHtml += createDayRowHtml(days[i]);
        }

        return `
            <div class="calendar-container">
                <div class="header">
                    <div class="month-large">${month}</div>
                    <div class="year-small">${year}</div>
                </div>
                <div class="calendar-body">
                    <div class="column column-left">${leftColHtml}</div>
                    <div class="column column-right">${rightColHtml}</div>
                </div>
                <div class="footer">${year} / ${month}</div>
            </div>
        `;
      }

      function createDayRowHtml(dayData) {
        if (!dayData) {
          return '<div class="day-row"></div>'; // 空行
        }

        let weekClass = "";
        if (dayData.dayIdx === 0 || dayData.isHoliday) weekClass = "text-sun";
        else if (dayData.dayIdx === 6) weekClass = "text-sat";

        const rowClass =
          dayData.dayIdx === 0 || dayData.isHoliday || dayData.dayIdx === 6
            ? "bg-holiday"
            : "";

        return `
            <div class="day-row ${rowClass}">
                <div class="day-num">${dayData.day}</div>
                <div class="day-week ${weekClass}">${dayData.week}</div>
                <div class="holiday-name">${dayData.holiday}</div>
            </div>
        `;
      }

      async function generateCalendar() {
        const year = parseInt(document.getElementById("yearInput").value);
        if (Object.keys(holidays).length === 0) {
          await fetchHolidays();
        }

        const output = document.getElementById("output");
        output.innerHTML = "";

        for (let m = 1; m <= 12; m += 2) {
          const page = document.createElement("div");
          page.className = "page";
          page.innerHTML =
            createMonthHtml(year, m) + createMonthHtml(year, m + 1);
          output.appendChild(page);
        }
      }

      // 初回実行
      window.onload = generateCalendar;
    </script>
  </body>
</html>
